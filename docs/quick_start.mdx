# Using SEGUL

## Command Structure

The app command structure is similar to git, gh-cli, or any other app that use subcommands. The app file name will be `segul` for Linux/MacOS/WSL and `segul.exe` for Windows.

```Bash
[THE-PROGRAM-FILENAME] <SUBCOMMAND> [OPTIONS] <VALUES> <A-FLAG-IF-APPLICABLE>
```

To check for available subcommand:

```Bash
segul --help
```

To check for available options and flags for each sub-command:

```Bash
segul <SUBCOMMAND> --help
```

## Computing sequence summary statistics

`segul` generate summary statistics for all alignment, each locus, and each taxon. To generate the summary statistics in for alignment files in a directory (usign `--dir` or `-d` option):

```Bash
segul summary --dir [a-path-to-a-directory] --input-format [sequence-format-keyword]
```

`segul` can also generate summary statistics for each alignment by passing `--per-locus` flag:

```Bash
segul summary --dir [a-path-to-a-directory] --input-format [sequence-format-keyword] --per-locus
```

## Concatenating alignments

To concat all alignments in a directory using `--dir` (or `-d` in short version):

```Bash
segul concat --dir [a-path-to-a-directory] --input-format [sequence-format-keyword]
```

Using `--input` (or `-i` in short version) option:

```Bash
segul concat --input [path/wildcard-to-your-files]
```

## Converting sequence formats

Segul can convert a single sequence file or multiple sequence files in a directory. To input the file, use `--dir` or `-d` option:

```Bash
segul convert --dir [path-to-your-repository] --input-format [sequence-format-keyword] --output-format [sequence-format-keyword]
```

Using `--input` (or `-i` in short version) option:

```Bash
segul convert --input [path/wildcard-to-your-files] --output-format [sequence-format-keyword]
```

## Converting partition formats

`segul` can convert a single and multiple partition files in multiple folders. It can extract partition embedded in NEXUS sequence files or merge codon model partition. For this command, the input option is only available using the `--input` option (or `-i` in short version).

```Bash
segul partition --input <a-path/wildcard-to-partition> --input-part <input-partition-format> --output-part<output-partition-format>
```

For example, to extract nexus in-file partitions (called charset format in `segul`):

```Bash
segul partition --input concatenated_alignment.nex --input-part charset --output-part nexus
```

You can also use wildcard to convert multiple concatenated alignment partitions at once:

```Bash
segul partition --input ./*/concatenated_alignment.nex --input-part charset --output-part nexus
```

When merging codon model partition, `segul` can clean up locus names if they are suffixes with subset{codon_pos}, subset\_{codon_pos}, or {codon_pos}\_pos. For example, for this partition format:

```Text
DNA, locus_1_subset1 = 1-10\3
DNA, locus_1_subest2 = 2-10\3
DNA, locus_1_subset3 = 3-10\3
DNA, locus_2_subset1 = 11-20\3
DNA, locus_2_subest2 = 12-20\3
DNA, locus_2_subset3 = 13-20\3
```

or

```Text
DNA, locus_1_1stpos = 1-10\3
DNA, locus_1_2ndpos = 2-10\3
DNA, locus_1_3rdpos = 3-10\3
DNA, locus_2_1stpos = 11-20\3
DNA, locus_2_2ndpos = 12-20\3
DNA, locus_2_3rdpos = 13-20\3
```

Will be merge as:

```Text
DNA, locus_1 = 1-10
DNA, locus_2 = 11-20
```

`segul` will save the resulting partition file in the current directory and the output file name will be the input file suffixed it with `_partition`. For example, if the input file is `alignment.nexus`, the output filename will be `alignment_partition.nex` or`alignment_partition.txt` (if the output is in a RaxML format)

## Extracting sequences in alignments

You can also extract sequences from a collection of alignments. It can be done by supplying a list of IDs directly using the command line or in a text file. `segul` will look for the exact match of the IDs and is case sensitive. You can also use regular expression for more flexiple option.

To extract sequences by inputing the IDs in the command line:

```bash
segul extract --dir [path-to-alignment-directory] --input-format [sequence-format-keyword] --id [id_1] [id_2] [id_3]
```

Using `--input` (or `-i` in short version) option:

```bash
segul extract --input [a-path/wilcard-to-files] --id [id_1] [id_2] [id_3]
```

You can specify as many id as you would like. However, for a long list of IDs, it may be more convenient to input a text file. In the file, the content should be only the list of IDs, one ID each line:

```bash
sequence_1
sequence_2
sequence_3
sequence_4
```

The the command will be:

```bash
segul extract --dir [path-to-alignment-directory] --input-format [sequence-format-keyword] --file [path-to-text-file]
```

For using regular expression:

```bash
segul extract -d gblock_trimmed_80p/ -f nexus --re="regex-syntax"
```

`segul` uses the rust [regex library](https://docs.rs/regex/1.5.4/regex/) to parse regular expression. The syntax is similar to Perl regular expression (find out more [here](https://docs.rs/regex/1.5.4/regex/)).
